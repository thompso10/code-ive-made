#blocks all but rustdesk
#!/bin/bash

# Flush existing rules
iptables -F
iptables -X

# Set default policies to drop all incoming and forwarding traffic
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT  # Outbound traffic is allowed by default

# Allow incoming traffic on localhost (loopback)
iptables -A INPUT -i lo -j ACCEPT

# Allow established and related connections
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# Allow incoming connections on the specified port range (21114-21149)
iptables -A INPUT -p tcp --dport 21114:21149 -j ACCEPT
iptables -A INPUT -p udp --dport 21114:21149 -j ACCEPT

# Save the rules (Debian-based systems)
iptables-save > /etc/iptables/rules.v4

echo "Firewall rules have been applied and saved."
